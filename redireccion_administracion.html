<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Administraci√≥n</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* üåà ESTILO GENERAL */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #ffcf70, #fadda4);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* üßæ CONTENEDOR */
    .admin-container {
      text-align: center;
      background: white;
      padding: 40px 60px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .admin-container h1 {
      color: #333;
      margin-bottom: 25px;
    }

    /* üîò BOTONES MEJORADOS */
    button {
      background: #d62828;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 14px;
      cursor: pointer;
      width: 260px;
      margin: 12px;

      /* sombras premium */
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      
      /* animaciones suaves */
      transition: all 0.25s ease;
    }

    button:hover {
      background: #ff914d;
      transform: translateY(-3px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.20);
    }

    button:active {
      transform: translateY(0px) scale(0.98);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    /* üîô BOT√ìN DE REGRESO */
    .back-button{
      position: fixed;
      top: 170px;
      right: 10px;
      z-index: 1000;
    }

    .back-button a{
      display: inline-flex;
      align-items:center;
      justify-content:center;
      width: 10px;
      height: 10px;
      background-color: white;
      color: rgb(0, 0, 0);
      text-decoration:none;
      padding: 12px 20px;
      border: 1px solid black;
      border-radius: 45px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .back-button .arrow{
      font-size: 3rem;
      display: block;
      transform: translateY(-6px);
    }

    .back-button a:hover{
      background-color: white;
      transform: scale(1.1);
    }
  </style>
</head>
<body>

  <!-- BOT√ìN DE REGRESO -->
  <div class="back-button">
    <a href="index.html"><span class="arrow">‚Üê</span></a>
  </div>

  <div class="admin-container">
    <h1>Panel de Administraci√≥n</h1>

    <!-- BOT√ìN DE RESERVAS -->
    <button id="pdfBtn">üìÑ Generar Resumen Reservas</button>

    <!-- BOT√ìN DE PQRS -->
    <button id="pqrBtn">üìÑ Generar Resumen PQRS</button>
  </div>

  <script>
    /* ==================================================
       üìÑ SCRIPT EXISTENTE (RESERVAS)
       ================================================== */
    const pdfBtn = document.getElementById("pdfBtn");

    pdfBtn.addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("RESUMEN DE RESERVAS", 20, 20);

      const fecha = new Date().toLocaleDateString("es-CO", {
        year: "numeric",
        month: "long",
        day: "numeric"
      });
      doc.setFontSize(12);
      doc.text(`Fecha del reporte: ${fecha}`, 20, 30);

      const reservas = JSON.parse(localStorage.getItem("reservas")) || [];
      const hoy = new Date().toLocaleDateString("es-CO");
      const reservasDeHoy = reservas.filter(r => r.fecha === hoy);

      if (reservasDeHoy.length === 0) {
        doc.text("No hay reservas registradas.", 20, 45);
        doc.save(`resumen_reservas_${fecha}.pdf`);
        return;
      }

      const jornadas = {};
      reservasDeHoy.forEach(r => {
        const jornada = r.jornada || "Personal Externo";
        if (!jornadas[jornada]) jornadas[jornada] = [];
        jornadas[jornada].push(r);
      });

      let y = 50;

      for (const [jornada, registros] of Object.entries(jornadas)) {
        doc.setFont("helvetica", "bold");
        doc.text(`Jornada: ${jornada}`, 20, y);
        y += 8;

        doc.setFont("helvetica", "normal");

        const productosJornada = {};
        registros.forEach(r => {
          if (!productosJornada[r.nombre]) productosJornada[r.nombre] = 0;
          productosJornada[r.nombre] += r.cantidad;
        });

        for (const [producto, cantidad] of Object.entries(productosJornada)) {
          doc.text(`‚Ä¢ ${cantidad} ${producto}`, 25, y);
          y += 6;
        }

        const usuarios = {};
        registros.forEach(r => {
          if (!usuarios[r.usuario]) usuarios[r.usuario] = {};
          if (!usuarios[r.usuario][r.nombre]) usuarios[r.usuario][r.nombre] = 0;
          usuarios[r.usuario][r.nombre] += r.cantidad;
        });

        for (const [usuario, pedidos] of Object.entries(usuarios)) {
          const detalles = Object.entries(pedidos)
            .map(([prod, cant]) => `${cant} ${prod}`).join(", ");
          doc.text(`- ${usuario}: ${detalles}`, 30, y);
          y += 6;
        }

        y += 10;
      }

      let totalGeneralPorProducto = {};

      for (const [jornada, registros] of Object.entries(jornadas)) {
        registros.forEach(r => {
          if (!totalGeneralPorProducto[r.nombre]) totalGeneralPorProducto[r.nombre] = 0;
          totalGeneralPorProducto[r.nombre] += r.cantidad;
        });
      }

      y += 10;
      doc.setFont("helvetica", "bold");
      doc.text("TOTAL DEL PEDIDO:", 20, y);
      y += 8;

      doc.setFont("helvetica", "normal");
      for (const [producto, total] of Object.entries(totalGeneralPorProducto)) {
        doc.text(`‚Ä¢ ${total} ${producto}`, 25, y);
        y += 6;
      }

      doc.save(`resumen_reservas_${fecha}.pdf`);
    });

    /* ==================================================
       ‚≠ê NUEVO SCRIPT PARA PQRS
       ================================================== */
    const pqrBtn = document.getElementById("pqrBtn");

    pqrBtn.addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("RESUMEN DE PQRS", 20, 20);

      const fecha = new Date().toLocaleDateString("es-CO", {
        year: "numeric",
        month: "long",
        day: "numeric"
      });
      doc.setFontSize(12);
      doc.text(`Fecha del reporte: ${fecha}`, 20, 30);

      const pqrs = JSON.parse(localStorage.getItem("pqr")) || [];

      if (pqrs.length === 0) {
        doc.text("No hay PQRS registradas.", 20, 45);
        doc.save(`resumen_pqrs_${fecha}.pdf`);
        return;
      }

      let y = 50;

      pqrs.forEach((pqr, index) => {
        if (y > 270) {
          doc.addPage();
          y = 20;
        }

        doc.setFont("helvetica", "bold");
        doc.text(`${index + 1}. Usuario: ${pqr.nombre}`, 20, y);
        y += 7;

        doc.setFont("helvetica", "normal");
        doc.text(`Mensaje: ${pqr.mensaje}`, 25, y);
        y += 7;

        doc.text(`Fecha: ${pqr.fecha}`, 25, y);
        y += 12;
      });

      doc.save(`resumen_pqrs_${fecha}.pdf`);
    });
  </script>

</body>
</html>
