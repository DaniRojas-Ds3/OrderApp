<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de Administraci√≥n</title>


<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: linear-gradient(135deg, #ffcf70, #fadda4);
  height: 100vh;
}

/* ===== LAYOUT ===== */
.admin-layout {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%;
}


/* ===== MEN√ö IZQUIERDO ===== */
.admin-menu {
  width: 100%;
  background: #ffffff;
  padding: 16px;
  display: flex;
  flex-direction: row;
  gap: 12px;
  overflow-x: auto;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}


.admin-menu h2 {
  display: none;
}


/* BOTONES MENU */
.menu-btn {
  background: #d62828;
  color: white;
  border: none;
  padding: 14px 20px;
  font-size: 15px;
  border-radius: 14px;
  cursor: pointer;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.25s ease;
}

.menu-btn:hover {
  background: #ff914d;
  transform: translateY(-2px);
}


/* ===== √ÅREA DE CONTENIDO ===== */
.content-area {
  flex: 1;
  padding: 30px;
  overflow-y: auto;
}

.content-box {
  background: white;
  padding: 35px;
  border-radius: 22px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  min-height: calc(100vh - 60px);
}

/* SECCIONES */
.section {
  display: none;
}

.section.active {
  display: block;
}



  .admin-layout {
    flex-direction: column;
  }

  /* MEN√ö ARRIBA */
  .admin-menu {
    width: 100%;
    flex-direction: row;
    overflow-x: auto;
    gap: 10px;
    padding: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  .admin-menu h2 {
    display: none;
  }

  .menu-btn {
    flex: 0 0 auto;
    white-space: nowrap;
    font-size: 16px;
    padding: 14px 18px;
    border-radius: 14px;
  }

  /* CONTENIDO ABAJO */
  .content-area {
    width: 100%;
    padding: 15px;
  }

  .content-box {
    min-height: auto;
    padding: 25px;
    border-radius: 18px;
  }

  /*---------------------------------------------------ESTILOS DEL FORMULARIO DE AGREGAR PRODUCTO----------------------------------------*/
  /* ===== FORMULARIO AGREGAR PRODUCTOS ===== */
.form-productos {
  max-width: 420px;
  margin: 0 auto;
  background: #eaddcb;
  padding: 28px;
  border-radius: 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
}

.form-productos .form-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 22px;
  margin-bottom: 20px;
  color: #333;
}

.form-productos label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
  font-size: 14px;
}

.form-productos input,
.form-productos select {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 15px;
}

.form-productos input:focus,
.form-productos select:focus {
  outline: none;
  border-color: #7b5cff;
}

.form-productos button {
  width: 100%;
  margin-top: 22px;
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: #ff0101;
  color: white;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s ease;
}

.form-productos button:hover {
  background: #ed1616;
}

.form-productos #mensaje {
  margin-top: 14px;
  text-align: center;
  font-weight: 600;
}

/*---------------------------------------------ESTILO DEL MESAJE DE PRODUCTOS ----------------------------------------------*/
.mensaje {
  margin-top: 18px;
  font-size: 16px;
}

.mensaje.exito {
  color: #16a34a; /* verde */
}

.mensaje.error {
  color: #dc2626; /* rojo */
}
/*--------------------------------------BOTONES DE DESCARGAR PDFS ---------------------------------------*/
.pdf-btn {
  background: #d62828;
  color: white;
  border: none;
  padding: 14px 20px;
  font-size: 15px;
  border-radius: 14px;
  cursor: pointer;
  margin-top: 15px;
  transition: all 0.25s ease;
}

.pdf-btn:hover {
  background: #ff914d;
  transform: translateY(-2px);
}
/*-------------------------------------------------------ESTILO DE SECCION DE EDITAR PRODUCTOS-----------------------------------*/
/* ---------- TABLA ADMIN ---------- */
.fila-producto {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  border-bottom: 1px solid #eee;
}

.nombre-producto {
  font-size: 16px;
  font-weight: 500;
}

.btn-editar {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 15px;
}

.btn-editar:hover {
  color: #ff9800;
}

/* m√≥vil */
@media (max-width: 768px) {
  .fila-producto {
    padding: 16px 10px;
  }
}

/*----------------------------------------------------------ESTILO DEL EDITOR--------------------------------------------*/
#editarProducto {
  background: #fff;
  padding: 25px;
  border-radius: 16px;
  max-width: 700px;
  margin: 0 auto;
}

#editarProducto h2 {
  margin-bottom: 20px;
}

#editarProducto label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

#editarProducto input,
#editarProducto select {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 8px;
  border: 1px solid #ccc;
}



</style>
</head>



<body>

<div class="admin-layout">

  <!-- MEN√ö -->
  <aside class="admin-menu">
    <h2>Men√∫</h2>

    <button class="menu-btn" onclick="mostrar('productos')">‚ûï Agregar productos </button>
    <button class="menu-btn" onclick="mostrar('precios')">‚úèÔ∏è Editor de productos</button>
    <button class="menu-btn" onclick="mostrar('eliminar')">‚úÇÔ∏è Eliminar de productos</button>
    <button class="menu-btn" onclick="mostrar('pdf-reservas')">üìÑ Resumen reservas</button>
    <button class="menu-btn" onclick="mostrar('pdf-pqrs')">üìÑ Resumen PQRS</button>
  </aside>

  <!-- CONTENIDO -->
  <main class="content-area">
    <div class="content-box">

  <!--------------------------- SECCION DE AGREGAR PRODUCTOS ------------------------------------- -->

      <div id="productos" class="section">
        <h2>Agregar Productos</h2>
        <p>Gesti√≥n completa de productos.</p>
        <h2>Agregar producto</h2>
<div class="form-productos">
  <h2>‚ûï Agregar producto</h2>

  <label>Nombre del producto</label>
  <input type="text" id="nombreProducto" placeholder="Ej: Caf√© Latte">

  <label>Precio</label>
  <input type="number" id="precioProducto" placeholder="Ej: 4500">

  <label>Categor√≠a</label>
  <select id="categoriaProducto">
  <option value="">Selecciona una categor√≠a</option>
    <option value="Comida">Comida</option>
    <option value="Bebidas">Bebidas</option>
    <option value="Combos">Combos</option>
    <option value="Paquetes">Paquetes</option>
    <option value="Helados">Helados</option>
    <option value="Greca">Greca</option>
    <option value="Jugos y Fruteria">Jugos y Fruteria</option>
    <option value="Pasteleria">Pasteleria</option>
    <option value="Productos Alpina">Productos Alpina</option>
    <option value="Dulceria">Dulceria</option>
  </select>
  
  <div class="campo">
  <label for="imagen">URL de la imagen (opcional)</label>
  <input
    type="url"
    id="imagen"
    placeholder="https://ejemplo.com/imagen.jpg"
  />
</div>


  <!-- PRODUCTO ACTIVO -->
  <label>
    <input type="checkbox" id="productoActivo" checked>
    Producto activo
  </label>

  <!-- PRECIO ACTIVO -->
  <label>
    <input type="checkbox" id="precioActivo" checked>
    Precio activo
  </label>

  <!-- ACTIVO EN RESERVAS -->
<label>
  <input type="checkbox" id="activoReservas">
  Mostrar en reservas
</label>


  <!-- BOT√ìN -->
  <button type="button" onclick="guardarProducto()">
    Guardar producto
  </button>
</div>




  <p id="mensaje"></p>
 
</div>
 <!-------------------------------------------------- SECCION DE EDITAR DE PRODUCTOS----------------------------------------- --> 
<div id="precios" class="section">
  <h2>Editor de Productos</h2>
  <p>Aqu√≠ podr√°s modificar los productos existentes.</p>

  <input
    type="text"
    id="buscadorProductos"
    placeholder="üîç Buscar producto..."
    style="width:100%;padding:10px;margin:15px 0;border-radius:8px;"
  >

  <table id="tablaProductos" style="width:100%;border-collapse:collapse;">
    <tbody id="listaProductosAdmin"></tbody>
  </table>
</div>

<!-- PANTALLA DE EDICI√ìN -->
<div id="editarProducto" class="section">

  <button onclick="volverALista()">‚¨Ö Volver</button>

  <h2>Editar producto</h2>

  <label>Nombre</label>
  <input type="text" id="editNombre">

  <label>Categor√≠a</label>
  <select id="editCategoria"></select>

  <label>Precio</label>
  <input type="number" id="editPrecio">

  <label><input type="checkbox" id="editActivo"> Producto activo</label>
  <label><input type="checkbox" id="editPrecioActivo"> Precio activo</label>
  <label><input type="checkbox" id="editActivoReservas"> Activo en reservas</label>

  <label>Imagen</label>
  <input type="url" id="editImagen">

  <br><br>
  <button onclick="guardarCambiosProducto()">üíæ Guardar</button>
  <button onclick="volverALista()">‚ùå Cancelar</button>
</div>


<!-------------------------------------------------- SECCION DE ELIMNINAR----------------------------------------- --> 

<div id="eliminar" class="section">
  <h2>Eliminar Productos</h2>
  <p>Elimina productos permanentemente de la base de datos.</p>

  <input
    type="text"
    id="buscadorEliminar"
    placeholder="üîç Buscar producto..."
    style="width:100%;padding:10px;margin:15px 0;border-radius:8px;"
  >

  <table style="width:100%;border-collapse:collapse;">
    <tbody id="listaEliminarProductos"></tbody>
  </table>
</div>


<!-------------------------------------------------- SECCION DE PDFS----------------------------------------- --> 
      <div id="pdf-reservas" class="section">
        <h2>Resumen de Reservas</h2>
        <button id="pdfBtn">üìÑ Generar PDF</button>
      </div>

      <div id="pdf-pqrs" class="section">
        <h2>Resumen de PQRS</h2>
        <button id="pqrBtn">üìÑ Generar PDF</button>
      </div>

    </div>
  </main>

</div>


<!-- üî• AQU√ç SIGUE TU JS ORIGINAL DE FIREBASE + PDFs SIN CAMBIOS -->

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script type="module">
function mostrar(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
// Mostrar secci√≥n por defecto al cargar la p√°gina
mostrar("productos");


// üëá HACERLA GLOBAL PARA LOS BOTONES HTML
window.mostrar = mostrar;

    // üåê URL de tu WebApp de Google Apps Script
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycby4gZuX2NTgJaOZttrV7-_P7ZMX4FPxccCvoWI3irZtEaYzhn9bT1FStnoClzvOEAB6Dw/exec";

/* ==================================================
   üìÑ PDF RESERVAS (con salto autom√°tico de p√°gina)
   ================================================== */

// Importar Firebase desde tu archivo firebase.js
import { db } from "./firebase.js";

import {
  collection,
  query,
  orderBy,
  onSnapshot,
  doc,
  getDoc,
  getDocs,        
  updateDoc,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";







// üî• Funci√≥n para traer reservas desde Firestore
async function cargarReservasDesdeFirestore() {
  const reservasRef = collection(db, "reservas");
  const q = query(reservasRef, orderBy("fechaCreacion", "desc"));
  const querySnapshot = await getDocs(q);

  const data = [];

  querySnapshot.forEach(doc => {
    const item = doc.data();

    // üî• Convertir timestamp correctamente
    if (item.fechaCreacion && item.fechaCreacion.toDate) {
      item.fechaCreacion = item.fechaCreacion.toDate();
    }

    data.push(item);
  });

  return data;
}


// ------------------- FIN CARGA DE RESERVAS ------------------------------//


const pdfBtn = document.getElementById("pdfBtn");

pdfBtn.addEventListener("click", async () => {

        const { jsPDF } = window.jspdf;

        // üìÑ TAMA√ëO CARTA REAL + COORDENADAS EN PUNTOS
        const doc = new jsPDF({
            unit: "pt",
            format: "letter"
        });

        // üëâ Funci√≥n para saltar p√°gina
        function checkPageLimit() {
            if (y >= 750) {       // l√≠mite para carta
                doc.addPage();
                y = 40;
            }
        }

        // -------- ENCABEZADO --------
        doc.setFont("helvetica", "bold");
        doc.setFontSize(18);
        doc.text("RESUMEN DE RESERVAS", 40, 40);

        const fecha = new Date().toLocaleDateString("es-CO", {
            year: "numeric",
            month: "long",
            day: "numeric"
        });

        doc.setFontSize(12);
        doc.text(`Fecha del reporte: ${fecha}`, 40, 60);

        // üî• Cargar reservas
        const reservas = await cargarReservasDesdeFirestore();

        const hoy = new Date().toLocaleDateString("es-CO");
        const reservasDeHoy = reservas.filter(r => r.fecha === hoy);

        if (reservasDeHoy.length === 0) {
            doc.text("No hay reservas registradas para hoy.", 40, 80);
            doc.save(`resumen_reservas_${fecha}.pdf`);
            return;
        }

        let y = 90;

        // ======================================================
        // üî• TOTAL GENERAL DE PRODUCTOS
        // ======================================================
        const totalGeneral = {};
        reservasDeHoy.forEach(r => {
            if (!totalGeneral[r.producto]) totalGeneral[r.producto] = 0;
            totalGeneral[r.producto] += r.cantidad;
        });

        doc.setFont("helvetica", "bold");
        doc.text("TOTAL GENERAL DE PRODUCTOS:", 40, y);
        y += 20;

        doc.setFont("helvetica", "normal");

        for (const [producto, cantidad] of Object.entries(totalGeneral)) {
            checkPageLimit();
            doc.text(`‚Ä¢ ${cantidad} ${producto}`, 50, y);
            y += 16;
        }

        y += 20;

        // ======================================================
        // üî• AGRUPAR POR JORNADAS (ORDEN PERSONALIZADO)
        // ======================================================
        const ordenJornadas = [
            "Jornada Externa",
            "Ma√±ana",
            "Tarde",
            "Noche"
        ];

        const jornadas = {};
        reservasDeHoy.forEach(r => {
            if (!jornadas[r.jornada]) jornadas[r.jornada] = [];
            jornadas[r.jornada].push(r);
        });

        for (const jornada of ordenJornadas) {

            if (!jornadas[jornada]) continue;

            checkPageLimit();
            doc.setFont("helvetica", "bold");
            doc.text(`Jornada: ${jornada}`, 40, y);
            y += 20;

            doc.setFont("helvetica", "normal");

            // üëâ Totales por jornada
            const productosJornada = {};
            jornadas[jornada].forEach(r => {
                if (!productosJornada[r.producto]) productosJornada[r.producto] = 0;
                productosJornada[r.producto] += r.cantidad;
            });

            for (const [producto, cantidad] of Object.entries(productosJornada)) {
                checkPageLimit();
                doc.text(`‚Ä¢ ${cantidad} ${producto}`, 50, y);
                y += 16;
            }

            y += 12;

            // üëâ Agrupaci√≥n por usuario
            const usuarios = {};
            jornadas[jornada].forEach(r => {
                if (!usuarios[r.usuario]) usuarios[r.usuario] = {};
                if (!usuarios[r.usuario][r.producto]) usuarios[r.usuario][r.producto] = 0;
                usuarios[r.usuario][r.producto] += r.cantidad;
            });

// üëâ Imprimir cada usuario con productos en lista
for (const [usuario, pedidos] of Object.entries(usuarios)) {

    // Antes de imprimir usuario ‚Üí verificar salto
    checkPageLimit();
    doc.text(`- ${usuario}:`, 30, y);
    y += 15;

    // Lista de productos bajo el usuario
    for (const [prod, cant] of Object.entries(pedidos)) {

        checkPageLimit(); // evita que se corte la l√≠nea

        doc.text(`‚Ä¢ ${cant} ${prod}`, 45, y);
        y += 14;
    }

    y += 12; // espacio entre usuarios
}
        }

        doc.save(`resumen_reservas_${fecha}.pdf`);
});

    /* ==================================================
       ‚≠ê PDF PQRS DESDE GOOGLE SHEETS (CORREGIDO)
       ================================================== */

    const pqrBtn = document.getElementById("pqrBtn");

    pqrBtn.addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      function line(y) {
        doc.setDrawColor(180);
        doc.line(20, y, 190, y);
      }

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("RESUMEN DE PQRS", 20, 20);

      const fecha = new Date().toLocaleDateString("es-CO", {
        year: "numeric",
        month: "long",
        day: "numeric"
      });

      doc.setFontSize(12);
      doc.text(`Fecha del reporte: ${fecha}`, 20, 30);

      // üî• Traer PQRS desde Google Sheets
      let pqrs = [];

      try {
        const res = await fetch(WEBAPP_URL);
        pqrs = await res.json();
      } catch (error) {
        alert("Error cargando PQRS desde Google Sheets.");
        return;
      }

      if (pqrs.length === 0) {
        doc.text("No hay PQRS registradas.", 20, 45);
        doc.save(`resumen_pqrs_${fecha}.pdf`);
        return;
      }

      let y = 50;

      pqrs.forEach((pqr, index) => {
        if (y > 260) {
          doc.addPage();
          y = 20;
        }

        doc.setFont("helvetica", "bold");
        doc.text(`${index + 1}. Usuario: ${pqr.nombre} ${pqr.apellido}`, 20, y);
        y += 8;

        doc.setFont("helvetica", "normal");
        doc.text(`Mensaje: ${pqr.mensaje}`, 25, y);
        y += 8;

        doc.text(`Fecha: ${pqr.fecha}`, 25, y);
        y += 10;

        line(y);
        y += 10;
      });

      doc.save(`resumen_pqrs_${fecha}.pdf`);
    });

    /*---------------------------------------------------- SCRIPT DE AGREGAR LOS PRODUCTOS --------------------------------------*/
async function guardarProducto() {
  const nombre = document.getElementById("nombreProducto").value.trim();
  const precio = Number(document.getElementById("precioProducto").value);
  const categoria = document.getElementById("categoriaProducto").value;
  const imagenInput = document.getElementById("imagen").value.trim();
  const productoActivo = document.getElementById("productoActivo").checked;
  const precioActivo = document.getElementById("precioActivo").checked;
  const activoReservas = document.getElementById("activoReservas").checked;


  const mensaje = document.getElementById("mensaje");
  mensaje.textContent = "";
  mensaje.className = "mensaje";

  if (!nombre || !precio || !categoria) {
    mensaje.textContent = "‚ö†Ô∏è Completa todos los campos obligatorios";
    mensaje.classList.add("error");
    return;
  }

  try {
    await addDoc(collection(db, "productos"), {
      nombre,
      precio,
      categoria,
      imagen: imagen || null,
      activo: productoActivo,
      precioActivo: precioActivo,
      activoReservas: activoReservas,
      creado: new Date()
    });

    mensaje.textContent = "‚úÖ Producto guardado correctamente";
    mensaje.classList.add("exito");

    // limpiar formulario
    document.getElementById("nombreProducto").value = "";
    document.getElementById("precioProducto").value = "";
    document.getElementById("categoriaProducto").value = "";
    document.getElementById("productoActivo").checked = true;
    document.getElementById("precioActivo").checked = true;
    document.getElementById("imagen").value = "";
    document.getElementById("activoReservas").checked = false;

    

  } catch (error) {
    console.error(error);
    mensaje.textContent = "‚ùå Error al guardar el producto";
    mensaje.classList.add("error");
  }
}

window.guardarProducto = guardarProducto;

/*----------------------------------------------------SCRIPT DE EDITOR DE PRODUCTOS--------------------------------------------*/
const listaAdmin = document.getElementById("listaProductosAdmin");

const q = query(
  collection(db, "productos"),
  orderBy("nombre")
);

onSnapshot(q, (snapshot) => {
  listaAdmin.innerHTML = "";

  snapshot.forEach((doc) => {
    const p = doc.data();

const fila = document.createElement("tr");
fila.dataset.categoria = (p.categoria || "").toLowerCase();

fila.innerHTML = `
  <td class="fila-producto">
    <span class="nombre-producto">${p.nombre}</span>
    <small class="categoria-producto">${p.categoria || ""}</small>
    <button class="btn-editar" onclick="editarProducto('${doc.id}')">
      ‚úèÔ∏è Editar
    </button>
  </td>
`;


    listaAdmin.appendChild(fila);
  });
});

/*----------------------------------------------- FUNCION EDITAR---------------------------------------------------*/
let productoEditandoId = null;

window.editarProducto = function (id) {
  productoEditandoId = id;

  document.querySelectorAll('.section')
    .forEach(s => s.classList.remove('active'));

  document.getElementById("editarProducto")
    .classList.add('active');

  cargarCategoriasEditor();
  cargarProducto(id);
};

/*--------------------------------------------------FUNCION BUSCADOR---------------------------------------------------------*/
const buscador = document.getElementById("buscadorProductos");

buscador.addEventListener("input", () => {
  const texto = buscador.value.toLowerCase().trim();

  const filas = listaAdmin.querySelectorAll("tr");

  filas.forEach(fila => {
    const nombre = fila
      .querySelector(".nombre-producto")
      .textContent
      .toLowerCase();

    const categoria = fila.dataset.categoria;

    const coincide =
      nombre.includes(texto) || categoria.includes(texto);

    fila.style.display = coincide ? "" : "none";
  });
});


/*----------------------------------------------- FUNCION VOLVER A LISTA---------------------------------------------------*/

function volverALista() {
  productoEditandoId = null;

  document.querySelectorAll('.section')
    .forEach(s => s.classList.remove('active'));

  document.getElementById("precios")
    .classList.add('active');
}



/*-----------------------------------------------CARGAR PRODUCTOS ---------------------------------------------------*/

async function cargarProducto(id) {
  const ref = doc(db, "productos", id);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    console.error("Producto no encontrado");
    return;
  }

  const p = snap.data();
  console.log("Producto cargado:", p);

  // üî• OBTENER ELEMENTOS AQU√ç (cuando ya existen)
  const editNombre = document.getElementById("editNombre");
  const editCategoria = document.getElementById("editCategoria");
  const editPrecio = document.getElementById("editPrecio");
  const editActivo = document.getElementById("editActivo");
  const editPrecioActivo = document.getElementById("editPrecioActivo");
  const editActivoReservas = document.getElementById("editActivoReservas");
  const editImagen = document.getElementById("editImagen");

  editNombre.value = p.nombre || "";
  editCategoria.value = p.categoria || "";
  editPrecio.value = p.precio || 0;
  editActivo.checked = !!p.activo;
  editPrecioActivo.checked = !!p.precioActivo;
  editActivoReservas.checked = !!p.activoReservas;
  editImagen.value = p.imagen || "";
}


/*-----------------------------------------------GUARDAR CAMBIOS ---------------------------------------------------*/
async function guardarCambiosProducto() {
  if (!productoEditandoId) return;

  // üî• obtener elementos AQU√ç tambi√©n
  const editNombre = document.getElementById("editNombre");
  const editCategoria = document.getElementById("editCategoria");
  const editPrecio = document.getElementById("editPrecio");
  const editActivo = document.getElementById("editActivo");
  const editPrecioActivo = document.getElementById("editPrecioActivo");
  const editActivoReservas = document.getElementById("editActivoReservas");
  const editImagen = document.getElementById("editImagen");

  const ref = doc(db, "productos", productoEditandoId);
  const snap = await getDoc(ref);
  if (!snap.exists()) return;

  const datosActuales = snap.data();

  await updateDoc(ref, {
    nombre: editNombre.value.trim(),
    categoria: editCategoria.value || datosActuales.categoria,
    precio: Number(editPrecio.value) || datosActuales.precio,
    activo: editActivo.checked,
    precioActivo: editPrecioActivo.checked,
    activoReservas: editActivoReservas.checked,
    imagen: editImagen.value.trim() || datosActuales.imagen,
    actualizado: serverTimestamp()
  });

  volverALista();
}


/*--------------------------------------------------------CARGAR CATEGORIAS ---------------------------------------------------*/

function cargarCategoriasEditor() {
  const select = document.getElementById("editCategoria");

  if (select.options.length > 0) return; // evita duplicar

  select.innerHTML = `
    <option value="">Seleccione una categor√≠a</option>
    <option value="Comida">Comida</option>
    <option value="Bebidas">Bebidas</option>
    <option value="Combos">Combos</option>
    <option value="Paquetes">Paquetes</option>
    <option value="Helados">Helados</option>
    <option value="Greca">Greca</option>
    <option value="Jugos y Fruteria">Jugos y Fruteria</option>
    <option value="Pasteleria">Pasteleria</option>
    <option value="Productos Alpina">Productos Alpina</option>
    <option value="Dulceria">Dulceria</option>
  `;
}
/*--------------------------------------------------------------ELIMINAR PRODUCTOS------------------------*/
/*====================================================
  ‚ùå ELIMINAR PRODUCTOS (MISMO DISE√ëO QUE EDITOR)
====================================================*/

import {
  deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const listaEliminar = document.getElementById("listaEliminarProductos");
const buscadorEliminar = document.getElementById("buscadorEliminar");

// üî• MISMA CONSULTA QUE EL EDITOR
onSnapshot(q, (snapshot) => {
  listaEliminar.innerHTML = "";

  snapshot.forEach((docSnap) => {
    const p = docSnap.data();

    const fila = document.createElement("tr");
    fila.dataset.categoria = (p.categoria || "").toLowerCase();

    fila.innerHTML = `
      <td class="fila-producto">
        <span class="nombre-producto">${p.nombre}</span>
        <small class="categoria-producto">${p.categoria || ""}</small>
        <button class="btn-editar" onclick="eliminarProducto('${docSnap.id}', '${p.nombre}')">
          ‚ùå Eliminar
        </button>
      </td>
    `;

    listaEliminar.appendChild(fila);
  });
});

/* üîç BUSCADOR (ID√âNTICO AL EDITOR) */
buscadorEliminar.addEventListener("input", () => {
  const texto = buscadorEliminar.value.toLowerCase().trim();

  listaEliminar.querySelectorAll("tr").forEach(fila => {
    const nombre = fila
      .querySelector(".nombre-producto")
      .textContent
      .toLowerCase();

    const categoria = fila.dataset.categoria;

    const coincide =
      nombre.includes(texto) || categoria.includes(texto);

    fila.style.display = coincide ? "" : "none";
  });
});

/* üß® FUNCI√ìN ELIMINAR */
window.eliminarProducto = async function (id, nombre) {
  const confirmar = confirm(`‚ö†Ô∏è ¬øSeguro que deseas eliminar "${nombre}"?\n\nEsta acci√≥n NO se puede deshacer.`);

  if (!confirmar) return;

  try {
    await deleteDoc(doc(db, "productos", id));
    alert("‚úÖ Producto eliminado correctamente");
  } catch (error) {
    console.error(error);
    alert("‚ùå Error al eliminar el producto");
  }
};

/*-------------------------------------------------------------------------------------------------------------*/



window.volverALista = volverALista;
window.guardarCambiosProducto = guardarCambiosProducto;
window.cargarProducto = cargarProducto;


</script>



</body>
</html>
